// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.kpdus.com/jad.html
// Decompiler options: packimports(3) fieldsfirst nonlb space 

package android.support.v4.print;

import android.content.ContentResolver;
import android.content.Context;
import android.graphics.*;
import android.net.Uri;
import android.os.*;
import android.print.*;
import android.print.pdf.PrintedPdfDocument;
import android.util.Log;
import java.io.*;

class PrintHelperKitkat {
    public static interface OnPrintFinishCallback {

        public abstract void onFinish();
    }


    public static final int COLOR_MODE_COLOR = 2;
    public static final int COLOR_MODE_MONOCHROME = 1;
    private static final String LOG_TAG = "PrintHelperKitkat";
    private static final int MAX_PRINT_SIZE = 3500;
    public static final int ORIENTATION_LANDSCAPE = 1;
    public static final int ORIENTATION_PORTRAIT = 2;
    public static final int SCALE_MODE_FILL = 2;
    public static final int SCALE_MODE_FIT = 1;
    int mColorMode;
    final Context mContext;
    android.graphics.BitmapFactory.Options mDecodeOptions;
    protected boolean mIsMinMarginsHandlingCorrect;
    private final Object mLock = new Object();
    int mOrientation;
    protected boolean mPrintActivityRespectsOrientation;
    int mScaleMode;

    PrintHelperKitkat(Context context) {
        mDecodeOptions = null;
        mScaleMode = 2;
        mColorMode = 2;
        mPrintActivityRespectsOrientation = true;
        mIsMinMarginsHandlingCorrect = true;
        mContext = context;
    }

    private Bitmap convertBitmapForColorMode(Bitmap bitmap, int i) {
        if (i == 1) {
            Bitmap bitmap1 = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), android.graphics.Bitmap.Config.ARGB_8888);
            Canvas canvas = new Canvas(bitmap1);
            Paint paint = new Paint();
            ColorMatrix colormatrix = new ColorMatrix();
            colormatrix.setSaturation(0.0F);
            paint.setColorFilter(new ColorMatrixColorFilter(colormatrix));
            canvas.drawBitmap(bitmap, 0.0F, 0.0F, paint);
            canvas.setBitmap(null);
            bitmap = bitmap1;
        }
        return bitmap;
    }

    private Matrix getMatrix(int i, int j, RectF rectf, int k) {
        Matrix matrix = new Matrix();
        float f = rectf.width() / (float)i;
        if (k == 2)
            f = Math.max(f, rectf.height() / (float)j);
        else
            f = Math.min(f, rectf.height() / (float)j);
        matrix.postScale(f, f);
        matrix.postTranslate((rectf.width() - (float)i * f) / 2.0F, (rectf.height() - f * (float)j) / 2.0F);
        return matrix;
    }

    private static boolean isPortrait(Bitmap bitmap) {
        boolean flag;
        if (bitmap.getWidth() <= bitmap.getHeight())
            flag = true;
        else
            flag = false;
        return flag;
    }

    private Bitmap loadBitmap(Uri uri, android.graphics.BitmapFactory.Options options) {
        Uri uri1;
        uri1 = null;
        if (uri == null || mContext == null)
            throw new IllegalArgumentException("bad argument to loadBitmap");
        uri = mContext.getContentResolver().openInputStream(uri);
        uri1 = uri;
        options = BitmapFactory.decodeStream(uri, null, options);
        if (uri != null)
            try {
                uri.close();
            }
            // Misplaced declaration of an exception variable
            catch (Uri uri) {
                Log.w("PrintHelperKitkat", "close fail ", uri);
            }
        return options;
        uri;
        if (uri1 != null)
            try {
                uri1.close();
            }
            // Misplaced declaration of an exception variable
            catch (android.graphics.BitmapFactory.Options options) {
                Log.w("PrintHelperKitkat", "close fail ", options);
            }
        throw uri;
    }

    private Bitmap loadConstrainedBitmap(Uri uri, int i) {
        int j;
        int l;
        int i1;
        android.graphics.BitmapFactory.Options options1;
        j = 1;
        options1 = null;
        if (i <= 0 || uri == null || mContext == null)
            throw new IllegalArgumentException("bad argument to getScaledBitmap");
        android.graphics.BitmapFactory.Options options = new android.graphics.BitmapFactory.Options();
        options.inJustDecodeBounds = true;
        loadBitmap(uri, options);
        i1 = options.outWidth;
        l = options.outHeight;
        obj = options1;
        if (i1 <= 0) goto _L2; else goto _L1
_L1:
        if (l > 0) goto _L4; else goto _L3
_L3:
        obj = options1;
_L2:
        return ((Bitmap) (obj));
_L4:
        for (int k = Math.max(i1, l); k > i;) {
            k >>>= 1;
            j <<= 1;
        }

        obj = options1;
        if (j <= 0)
            continue; /* Loop/switch isn't completed */
        obj = options1;
        if (Math.min(i1, l) / j <= 0)
            continue; /* Loop/switch isn't completed */
        synchronized (mLock) {
            options1 = JVM INSTR new #219 <Class android.graphics.BitmapFactory$Options>;
            options1.android.graphics.BitmapFactory.Options();
            mDecodeOptions = options1;
            mDecodeOptions.inMutable = true;
            mDecodeOptions.inSampleSize = j;
            options1 = mDecodeOptions;
        }
        obj = loadBitmap(uri, options1);
        synchronized (mLock) {
            mDecodeOptions = null;
        }
        if (true) goto _L2; else goto _L5
_L5:
        obj;
        uri;
        JVM INSTR monitorexit ;
        throw obj;
        uri;
        obj;
        JVM INSTR monitorexit ;
        throw uri;
        Exception exception;
        exception;
        synchronized (mLock) {
            mDecodeOptions = null;
        }
        throw exception;
        exception1;
        uri;
        JVM INSTR monitorexit ;
        throw exception1;
    }

    private void writeBitmap(final PrintAttributes attributes, final int fittingMode, final Bitmap bitmap, final ParcelFileDescriptor fileDescriptor, final CancellationSignal cancellationSignal, final android.print.PrintDocumentAdapter.WriteResultCallback writeResultCallback) {
        final PrintAttributes pdfAttributes;
        if (mIsMinMarginsHandlingCorrect)
            pdfAttributes = attributes;
        else
            pdfAttributes = copyAttributes(attributes).setMinMargins(new android.print.PrintAttributes.Margins(0, 0, 0, 0)).build();
        (new AsyncTask() {

            final PrintHelperKitkat this$0;
            final PrintAttributes val$attributes;
            final Bitmap val$bitmap;
            final CancellationSignal val$cancellationSignal;
            final ParcelFileDescriptor val$fileDescriptor;
            final int val$fittingMode;
            final PrintAttributes val$pdfAttributes;
            final android.print.PrintDocumentAdapter.WriteResultCallback val$writeResultCallback;

            protected volatile Object doInBackground(Object aobj[]) {
                return doInBackground((Void[])aobj);
            }

            protected transient Throwable doInBackground(Void avoid[]) {
                ParcelFileDescriptor parcelfiledescriptor = null;
                if (!cancellationSignal.isCanceled()) goto _L2; else goto _L1
_L1:
                avoid = parcelfiledescriptor;
_L4:
                return avoid;
_L2:
                boolean flag;
                Bitmap bitmap1;
                PrintedPdfDocument printedpdfdocument;
                printedpdfdocument = JVM INSTR new #66  <Class PrintedPdfDocument>;
                printedpdfdocument.PrintedPdfDocument(mContext, pdfAttributes);
                bitmap1 = convertBitmapForColorMode(bitmap, pdfAttributes.getColorMode());
                flag = cancellationSignal.isCanceled();
                avoid = parcelfiledescriptor;
                if (flag) goto _L4; else goto _L3
_L3:
                android.graphics.pdf.PdfDocument.Page page = printedpdfdocument.startPage(1);
                if (!mIsMinMarginsHandlingCorrect) goto _L6; else goto _L5
_L5:
                avoid = JVM INSTR new #93  <Class RectF>;
                avoid.RectF(page.getInfo().getContentRect());
_L12:
                Object obj = getMatrix(bitmap1.getWidth(), bitmap1.getHeight(), avoid, fittingMode);
                if (!mIsMinMarginsHandlingCorrect) goto _L8; else goto _L7
_L7:
                page.getCanvas().drawBitmap(bitmap1, ((Matrix) (obj)), null);
                printedpdfdocument.finishPage(page);
                flag = cancellationSignal.isCanceled();
                if (!flag) goto _L10; else goto _L9
_L9:
                printedpdfdocument.close();
                avoid = fileDescriptor;
                if (avoid == null)
                    break MISSING_BLOCK_LABEL_192;
                fileDescriptor.close();
_L15:
                avoid = parcelfiledescriptor;
                if (bitmap1 == bitmap) goto _L4; else goto _L11
_L11:
                bitmap1.recycle();
                avoid = parcelfiledescriptor;
                  goto _L4
                avoid;
                  goto _L4
_L6:
                PrintedPdfDocument printedpdfdocument1 = JVM INSTR new #66  <Class PrintedPdfDocument>;
                printedpdfdocument1.PrintedPdfDocument(mContext, attributes);
                obj = printedpdfdocument1.startPage(1);
                avoid = JVM INSTR new #93  <Class RectF>;
                avoid.RectF(((android.graphics.pdf.PdfDocument.Page) (obj)).getInfo().getContentRect());
                printedpdfdocument1.finishPage(((android.graphics.pdf.PdfDocument.Page) (obj)));
                printedpdfdocument1.close();
                  goto _L12
                avoid;
                printedpdfdocument.close();
                parcelfiledescriptor = fileDescriptor;
                if (parcelfiledescriptor == null)
                    break MISSING_BLOCK_LABEL_299;
                try {
                    fileDescriptor.close();
                }
                catch (IOException ioexception) { }
                if (bitmap1 != bitmap)
                    bitmap1.recycle();
                throw avoid;
_L8:
                ((Matrix) (obj)).postTranslate(((RectF) (avoid)).left, ((RectF) (avoid)).top);
                page.getCanvas().clipRect(avoid);
                  goto _L7
_L10:
                avoid = JVM INSTR new #162 <Class FileOutputStream>;
                avoid.FileOutputStream(fileDescriptor.getFileDescriptor());
                printedpdfdocument.writeTo(avoid);
                printedpdfdocument.close();
                avoid = fileDescriptor;
                if (avoid == null)
                    break MISSING_BLOCK_LABEL_384;
                fileDescriptor.close();
_L14:
                avoid = parcelfiledescriptor;
                if (bitmap1 == bitmap) goto _L4; else goto _L13
_L13:
                bitmap1.recycle();
                avoid = parcelfiledescriptor;
                  goto _L4
                avoid;
                  goto _L14
                avoid;
                  goto _L15
            }

            protected volatile void onPostExecute(Object obj) {
                onPostExecute((Throwable)obj);
            }

            protected void onPostExecute(Throwable throwable) {
                if (cancellationSignal.isCanceled())
                    writeResultCallback.onWriteCancelled();
                else
                if (throwable == null) {
                    writeResultCallback.onWriteFinished(new PageRange[] {
                        PageRange.ALL_PAGES
                    });
                } else {
                    Log.e("PrintHelperKitkat", "Error writing printed content", throwable);
                    writeResultCallback.onWriteFailed(null);
                }
            }

             {
                this$0 = PrintHelperKitkat.this;
                cancellationSignal = cancellationsignal;
                pdfAttributes = printattributes;
                bitmap = bitmap1;
                attributes = printattributes1;
                fittingMode = i;
                fileDescriptor = parcelfiledescriptor;
                writeResultCallback = writeresultcallback;
                super();
            }
        }
).execute(new Void[0]);
    }

    protected android.print.PrintAttributes.Builder copyAttributes(PrintAttributes printattributes) {
        android.print.PrintAttributes.Builder builder = (new android.print.PrintAttributes.Builder()).setMediaSize(printattributes.getMediaSize()).setResolution(printattributes.getResolution()).setMinMargins(printattributes.getMinMargins());
        if (printattributes.getColorMode() != 0)
            builder.setColorMode(printattributes.getColorMode());
        return builder;
    }

    public int getColorMode() {
        return mColorMode;
    }

    public int getOrientation() {
        int i;
        if (mOrientation == 0)
            i = 1;
        else
            i = mOrientation;
        return i;
    }

    public int getScaleMode() {
        return mScaleMode;
    }

    public void printBitmap(final String jobName, final Bitmap bitmap, final OnPrintFinishCallback callback) {
        if (bitmap != null) {
            final int fittingMode = mScaleMode;
            PrintManager printmanager = (PrintManager)mContext.getSystemService("print");
            Object obj;
            if (isPortrait(bitmap))
                obj = android.print.PrintAttributes.MediaSize.UNKNOWN_PORTRAIT;
            else
                obj = android.print.PrintAttributes.MediaSize.UNKNOWN_LANDSCAPE;
            obj = (new android.print.PrintAttributes.Builder()).setMediaSize(((android.print.PrintAttributes.MediaSize) (obj))).setColorMode(mColorMode).build();
            printmanager.print(jobName, new PrintDocumentAdapter() {

                private PrintAttributes mAttributes;
                final PrintHelperKitkat this$0;
                final Bitmap val$bitmap;
                final OnPrintFinishCallback val$callback;
                final int val$fittingMode;
                final String val$jobName;

                public void onFinish() {
                    if (callback != null)
                        callback.onFinish();
                }

                public void onLayout(PrintAttributes printattributes, PrintAttributes printattributes1, CancellationSignal cancellationsignal, android.print.PrintDocumentAdapter.LayoutResultCallback layoutresultcallback, Bundle bundle) {
                    boolean flag = true;
                    mAttributes = printattributes1;
                    cancellationsignal = (new android.print.PrintDocumentInfo.Builder(jobName)).setContentType(1).setPageCount(1).build();
                    if (printattributes1.equals(printattributes))
                        flag = false;
                    layoutresultcallback.onLayoutFinished(cancellationsignal, flag);
                }

                public void onWrite(PageRange apagerange[], ParcelFileDescriptor parcelfiledescriptor, CancellationSignal cancellationsignal, android.print.PrintDocumentAdapter.WriteResultCallback writeresultcallback) {
                    writeBitmap(mAttributes, fittingMode, bitmap, parcelfiledescriptor, cancellationsignal, writeresultcallback);
                }

             {
                this$0 = PrintHelperKitkat.this;
                jobName = s;
                fittingMode = i;
                bitmap = bitmap1;
                callback = onprintfinishcallback;
                super();
            }
            }
, ((PrintAttributes) (obj)));
        }
    }

    public void printBitmap(final String jobName, final Uri imageFile, final OnPrintFinishCallback callback) {
        PrintDocumentAdapter printdocumentadapter;
        printdocumentadapter = new PrintDocumentAdapter() {

            private PrintAttributes mAttributes;
            Bitmap mBitmap;
            AsyncTask mLoadBitmap;
            final PrintHelperKitkat this$0;
            final OnPrintFinishCallback val$callback;
            final int val$fittingMode;
            final Uri val$imageFile;
            final String val$jobName;

            private void cancelLoad() {
                synchronized (mLock) {
                    if (mDecodeOptions != null) {
                        mDecodeOptions.requestCancelDecode();
                        mDecodeOptions = null;
                    }
                }
                return;
                exception;
                obj;
                JVM INSTR monitorexit ;
                throw exception;
            }

            public void onFinish() {
                super.onFinish();
                cancelLoad();
                if (mLoadBitmap != null)
                    mLoadBitmap.cancel(true);
                if (callback != null)
                    callback.onFinish();
                if (mBitmap != null) {
                    mBitmap.recycle();
                    mBitmap = null;
                }
            }

            public void onLayout(final PrintAttributes oldPrintAttributes, final PrintAttributes newPrintAttributes, final CancellationSignal cancellationSignal, android.print.PrintDocumentAdapter.LayoutResultCallback layoutresultcallback, Bundle bundle) {
                boolean flag = true;
                this;
                JVM INSTR monitorenter ;
                mAttributes = newPrintAttributes;
                this;
                JVM INSTR monitorexit ;
                if (cancellationSignal.isCanceled())
                    layoutresultcallback.onLayoutCancelled();
                else
                if (mBitmap != null) {
                    cancellationSignal = (new android.print.PrintDocumentInfo.Builder(jobName)).setContentType(1).setPageCount(1).build();
                    if (newPrintAttributes.equals(oldPrintAttributes))
                        flag = false;
                    layoutresultcallback.onLayoutFinished(cancellationSignal, flag);
                } else {
                    mLoadBitmap = (layoutresultcallback. new AsyncTask() {

                        final _cls3 this$1;
                        final CancellationSignal val$cancellationSignal;
                        final android.print.PrintDocumentAdapter.LayoutResultCallback val$layoutResultCallback;
                        final PrintAttributes val$newPrintAttributes;
                        final PrintAttributes val$oldPrintAttributes;

                        protected transient Bitmap doInBackground(Uri auri[]) {
                            try {
                                auri = loadConstrainedBitmap(imageFile, 3500);
                            }
                            // Misplaced declaration of an exception variable
                            catch (Uri auri[]) {
                                auri = null;
                            }
                            return auri;
                        }

                        protected volatile Object doInBackground(Object aobj[]) {
                            return doInBackground((Uri[])aobj);
                        }

                        protected void onCancelled(Bitmap bitmap) {
                            layoutResultCallback.onLayoutCancelled();
                            mLoadBitmap = null;
                        }

                        protected volatile void onCancelled(Object obj) {
                            onCancelled((Bitmap)obj);
                        }

                        protected void onPostExecute(Bitmap bitmap) {
                            boolean flag;
                            Object obj;
                            flag = true;
                            super.onPostExecute(bitmap);
                            obj = bitmap;
                            if (bitmap == null)
                                break MISSING_BLOCK_LABEL_110;
                            if (mPrintActivityRespectsOrientation) {
                                obj = bitmap;
                                if (mOrientation != 0)
                                    break MISSING_BLOCK_LABEL_110;
                            }
                            this;
                            JVM INSTR monitorenter ;
                            android.print.PrintAttributes.MediaSize mediasize = mAttributes.getMediaSize();
                            this;
                            JVM INSTR monitorexit ;
                            obj = bitmap;
                            if (mediasize != null) {
                                obj = bitmap;
                                if (mediasize.isPortrait() != PrintHelperKitkat.isPortrait(bitmap)) {
                                    obj = new Matrix();
                                    ((Matrix) (obj)).postRotate(90F);
                                    obj = Bitmap.createBitmap(bitmap, 0, 0, bitmap.getWidth(), bitmap.getHeight(), ((Matrix) (obj)), true);
                                }
                            }
                            mBitmap = ((Bitmap) (obj));
                            if (obj != null) {
                                bitmap = (new android.print.PrintDocumentInfo.Builder(jobName)).setContentType(1).setPageCount(1).build();
                                if (newPrintAttributes.equals(oldPrintAttributes))
                                    flag = false;
                                layoutResultCallback.onLayoutFinished(bitmap, flag);
                            } else {
                                layoutResultCallback.onLayoutFailed(null);
                            }
                            mLoadBitmap = null;
                            return;
                            bitmap;
                            this;
                            JVM INSTR monitorexit ;
                            throw bitmap;
                        }

                        protected volatile void onPostExecute(Object obj) {
                            onPostExecute((Bitmap)obj);
                        }

                        protected void onPreExecute() {
                            cancellationSignal.setOnCancelListener(new android.os.CancellationSignal.OnCancelListener() {

                                final _cls1 this$2;

                                public void onCancel() {
                                    cancelLoad();
                                    cancel(false);
                                }

             {
                this$2 = _cls1.this;
                super();
            }
                            }
);
                        }

             {
                this$1 = final__pcls3;
                cancellationSignal = cancellationsignal;
                newPrintAttributes = printattributes;
                oldPrintAttributes = printattributes1;
                layoutResultCallback = android.print.PrintDocumentAdapter.LayoutResultCallback.this;
                super();
            }
                    }
).execute(new Uri[0]);
                }
                return;
                oldPrintAttributes;
                this;
                JVM INSTR monitorexit ;
                throw oldPrintAttributes;
            }

            public void onWrite(PageRange apagerange[], ParcelFileDescriptor parcelfiledescriptor, CancellationSignal cancellationsignal, android.print.PrintDocumentAdapter.WriteResultCallback writeresultcallback) {
                writeBitmap(mAttributes, fittingMode, mBitmap, parcelfiledescriptor, cancellationsignal, writeresultcallback);
            }



             {
                this$0 = PrintHelperKitkat.this;
                jobName = s;
                imageFile = uri;
                callback = onprintfinishcallback;
                fittingMode = i;
                super();
                mBitmap = null;
            }
        }
;
        imageFile = (PrintManager)mContext.getSystemService("print");
        callback = new android.print.PrintAttributes.Builder();
        callback.setColorMode(mColorMode);
        if (mOrientation != 1 && mOrientation != 0) goto _L2; else goto _L1
_L1:
        callback.setMediaSize(android.print.PrintAttributes.MediaSize.UNKNOWN_LANDSCAPE);
_L4:
        imageFile.print(jobName, printdocumentadapter, callback.build());
        return;
_L2:
        if (mOrientation == 2)
            callback.setMediaSize(android.print.PrintAttributes.MediaSize.UNKNOWN_PORTRAIT);
        if (true) goto _L4; else goto _L3
_L3:
    }

    public void setColorMode(int i) {
        mColorMode = i;
    }

    public void setOrientation(int i) {
        mOrientation = i;
    }

    public void setScaleMode(int i) {
        mScaleMode = i;
    }






}
