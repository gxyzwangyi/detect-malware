// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.kpdus.com/jad.html
// Decompiler options: packimports(3) fieldsfirst nonlb space 

package android.support.v7.widget;

import android.content.Context;
import android.content.res.Configuration;
import android.content.res.Resources;
import android.graphics.drawable.Drawable;
import android.os.Parcel;
import android.os.Parcelable;
import android.support.v4.graphics.drawable.DrawableCompat;
import android.support.v4.view.ActionProvider;
import android.support.v7.transition.ActionBarTransition;
import android.support.v7.view.ActionBarPolicy;
import android.support.v7.view.menu.*;
import android.util.DisplayMetrics;
import android.util.SparseBooleanArray;
import android.view.*;
import java.util.ArrayList;

// Referenced classes of package android.support.v7.widget:
//            ActionMenuView, AppCompatImageView, ForwardingListener

class ActionMenuPresenter extends BaseMenuPresenter
    implements android.support.v4.view.ActionProvider.SubUiVisibilityListener {
    /* member class not found */
    class ActionButtonSubmenu {}

    private class ActionMenuPopupCallback extends android.support.v7.view.menu.ActionMenuItemView.PopupCallback {

        final ActionMenuPresenter this$0;

        public ShowableListMenu getPopup() {
            android.support.v7.view.menu.MenuPopup menupopup;
            if (mActionButtonPopup != null)
                menupopup = mActionButtonPopup.getPopup();
            else
                menupopup = null;
            return menupopup;
        }

        ActionMenuPopupCallback() {
            this$0 = ActionMenuPresenter.this;
            PopupCallback();
        }
    }

    private class OverflowMenuButton extends AppCompatImageView
        implements ActionMenuView.ActionMenuChildView {

        private final float mTempPts[] = new float[2];
        final ActionMenuPresenter this$0;

        public boolean needsDividerAfter() {
            return false;
        }

        public boolean needsDividerBefore() {
            return false;
        }

        public boolean performClick() {
            if (!performClick()) {
                playSoundEffect(0);
                showOverflowMenu();
            }
            return true;
        }

        protected boolean setFrame(int i, int j, int k, int l) {
            boolean flag = setFrame(i, j, k, l);
            Drawable drawable1 = getDrawable();
            Drawable drawable = getBackground();
            if (drawable1 != null && drawable != null) {
                int i1 = getWidth();
                l = getHeight();
                i = Math.max(i1, l) / 2;
                int j1 = getPaddingLeft();
                int k1 = getPaddingRight();
                k = getPaddingTop();
                j = getPaddingBottom();
                i1 = (i1 + (j1 - k1)) / 2;
                j = (l + (k - j)) / 2;
                DrawableCompat.setHotspotBounds(drawable, i1 - i, j - i, i1 + i, j + i);
            }
            return flag;
        }

        public OverflowMenuButton(Context context) {
            this$0 = ActionMenuPresenter.this;
            AppCompatImageView(context, null, android.support.v7.appcompat.R.attr.actionOverflowButtonStyle);
            setClickable(true);
            setFocusable(true);
            setVisibility(0);
            setEnabled(true);
            setOnTouchListener(new _cls1(ActionMenuPresenter.this));
        }
    }

    private class PopupPresenterCallback
        implements android.support.v7.view.menu.MenuPresenter.Callback {

        final ActionMenuPresenter this$0;

        public void onCloseMenu(MenuBuilder menubuilder, boolean flag) {
            if (menubuilder instanceof SubMenuBuilder)
                menubuilder.getRootMenu().close(false);
            android.support.v7.view.menu.MenuPresenter.Callback callback = getCallback();
            if (callback != null)
                callback.onCloseMenu(menubuilder, flag);
        }

        public boolean onOpenSubMenu(MenuBuilder menubuilder) {
            boolean flag = false;
            if (menubuilder != null) {
                mOpenSubMenuId = ((SubMenuBuilder)menubuilder).getItem().getItemId();
                android.support.v7.view.menu.MenuPresenter.Callback callback = getCallback();
                if (callback != null)
                    flag = callback.onOpenSubMenu(menubuilder);
                else
                    flag = false;
            }
            return flag;
        }

        PopupPresenterCallback() {
            this$0 = ActionMenuPresenter.this;
            Object();
        }
    }

    private static class SavedState
        implements Parcelable {

        public static final android.os.Parcelable.Creator CREATOR = new android.os.Parcelable.Creator() {

            public SavedState createFromParcel(Parcel parcel) {
                return new SavedState(parcel);
            }

            public volatile Object createFromParcel(Parcel parcel) {
                return createFromParcel(parcel);
            }

            public SavedState[] newArray(int i) {
                return new SavedState[i];
            }

            public volatile Object[] newArray(int i) {
                return newArray(i);
            }

        }
;
        public int openSubMenuId;

        public int describeContents() {
            return 0;
        }

        public void writeToParcel(Parcel parcel, int i) {
            parcel.writeInt(openSubMenuId);
        }


        SavedState() {
        }

        SavedState(Parcel parcel) {
            openSubMenuId = parcel.readInt();
        }
    }


    private static final String TAG = "ActionMenuPresenter";
    private final SparseBooleanArray mActionButtonGroups = new SparseBooleanArray();
    ActionButtonSubmenu mActionButtonPopup;
    private int mActionItemWidthLimit;
    private boolean mExpandedActionViewsExclusive;
    private int mMaxItems;
    private boolean mMaxItemsSet;
    private int mMinCellSize;
    int mOpenSubMenuId;
    OverflowMenuButton mOverflowButton;
    OverflowPopup mOverflowPopup;
    private Drawable mPendingOverflowIcon;
    private boolean mPendingOverflowIconSet;
    private ActionMenuPopupCallback mPopupCallback;
    final PopupPresenterCallback mPopupPresenterCallback = new PopupPresenterCallback();
    OpenOverflowRunnable mPostedOpenRunnable;
    private boolean mReserveOverflow;
    private boolean mReserveOverflowSet;
    private View mScrapActionButtonView;
    private boolean mStrictWidthLimit;
    private int mWidthLimit;
    private boolean mWidthLimitSet;

    public ActionMenuPresenter(Context context) {
        BaseMenuPresenter(context, android.support.v7.appcompat.R.layout.abc_action_menu_layout, android.support.v7.appcompat.R.layout.abc_action_menu_item_layout);
    }

    private View findViewForItem(MenuItem menuitem) {
        ViewGroup viewgroup = (ViewGroup)mMenuView;
        if (viewgroup != null) goto _L2; else goto _L1
_L1:
        View view = null;
_L4:
        return view;
_L2:
        int j = viewgroup.getChildCount();
        for (int i = 0; i < j; i++) {
            View view1 = viewgroup.getChildAt(i);
            if (!(view1 instanceof android.support.v7.view.menu.MenuView.ItemView))
                continue;
            view = view1;
            if (((android.support.v7.view.menu.MenuView.ItemView)view1).getItemData() == menuitem)
                continue; /* Loop/switch isn't completed */
        }

        view = null;
        if (true) goto _L4; else goto _L3
_L3:
    }

    public void bindItemView(MenuItemImpl menuitemimpl, android.support.v7.view.menu.MenuView.ItemView itemview) {
        itemview.initialize(menuitemimpl, 0);
        menuitemimpl = (ActionMenuView)mMenuView;
        itemview = (ActionMenuItemView)itemview;
        itemview.setItemInvoker(menuitemimpl);
        if (mPopupCallback == null)
            mPopupCallback = new ActionMenuPopupCallback();
        itemview.setPopupCallback(mPopupCallback);
    }

    public boolean dismissPopupMenus() {
        return hideOverflowMenu() | hideSubMenus();
    }

    public boolean filterLeftoverView(ViewGroup viewgroup, int i) {
        boolean flag;
        if (viewgroup.getChildAt(i) == mOverflowButton)
            flag = false;
        else
            flag = filterLeftoverView(viewgroup, i);
        return flag;
    }

    public boolean flagActionItems() {
        int k;
        int l;
        int j2;
        int i3;
        int j4;
        ArrayList arraylist;
        ViewGroup viewgroup;
label0:
        {
            int i;
            int i1;
            boolean flag;
            if (mMenu != null) {
                arraylist = mMenu.getVisibleItems();
                j2 = arraylist.size();
            } else {
                j2 = 0;
                arraylist = null;
            }
            i = mMaxItems;
            i3 = mActionItemWidthLimit;
            j4 = android.view.View.MeasureSpec.makeMeasureSpec(0, 0);
            viewgroup = (ViewGroup)mMenuView;
            l = 0;
            i1 = 0;
            flag = false;
            k = 0;
            while (k < j2)  {
                MenuItemImpl menuitemimpl = (MenuItemImpl)arraylist.get(k);
                if (menuitemimpl.requiresActionButton())
                    l++;
                else
                if (menuitemimpl.requestsActionButton())
                    i1++;
                else
                    flag = true;
                if (mExpandedActionViewsExclusive && menuitemimpl.isActionViewExpanded())
                    i = 0;
                k++;
            }
            k = i;
            if (!mReserveOverflow)
                break label0;
            if (!flag) {
                k = i;
                if (l + i1 <= i)
                    break label0;
            }
            k = i - 1;
        }
        k -= l;
        SparseBooleanArray sparsebooleanarray = mActionButtonGroups;
        sparsebooleanarray.clear();
        int j = 0;
        int k1;
        boolean flag1;
        int k2;
        int l2;
        if (mStrictWidthLimit) {
            j = i3 / mMinCellSize;
            int j1 = mMinCellSize;
            l = mMinCellSize;
            k2 = (i3 % j1) / j + l;
        } else {
            k2 = 0;
        }
        l2 = 0;
        flag1 = false;
        l = j;
        j = k;
        k1 = i3;
        k = ((flag1) ? 1 : 0);
        while (l2 < j2)  {
            MenuItemImpl menuitemimpl1 = (MenuItemImpl)arraylist.get(l2);
            int l1;
            if (menuitemimpl1.requiresActionButton()) {
                View view = getItemView(menuitemimpl1, mScrapActionButtonView, viewgroup);
                if (mScrapActionButtonView == null)
                    mScrapActionButtonView = view;
                int j3;
                if (mStrictWidthLimit) {
                    l1 = l - ActionMenuView.measureChildForCells(view, k2, l, j4, 0);
                } else {
                    view.measure(j4, j4);
                    l1 = l;
                }
                l = view.getMeasuredWidth();
                if (k == 0)
                    k = l;
                j3 = menuitemimpl1.getGroupId();
                if (j3 != 0)
                    sparsebooleanarray.put(j3, true);
                menuitemimpl1.setIsActionButton(true);
                k1 -= l;
                l = j;
                j = k;
                k = k1;
            } else
            if (menuitemimpl1.requestsActionButton()) {
                int k4 = menuitemimpl1.getGroupId();
                boolean flag3 = sparsebooleanarray.get(k4);
                boolean flag2;
                if ((j > 0 || flag3) && k1 > 0 && (!mStrictWidthLimit || l > 0))
                    flag2 = true;
                else
                    flag2 = false;
                int i4;
                if (flag2) {
                    View view1 = getItemView(menuitemimpl1, mScrapActionButtonView, viewgroup);
                    if (mScrapActionButtonView == null)
                        mScrapActionButtonView = view1;
                    int k3;
                    if (mStrictWidthLimit) {
                        l1 = ActionMenuView.measureChildForCells(view1, k2, l, j4, 0);
                        if (l1 == 0)
                            flag2 = false;
                        l -= l1;
                    } else {
                        view1.measure(j4, j4);
                    }
                    l1 = view1.getMeasuredWidth();
                    k3 = k1 - l1;
                    k1 = k;
                    if (k == 0)
                        k1 = l1;
                    if (mStrictWidthLimit) {
                        if (k3 >= 0)
                            k = 1;
                        else
                            k = 0;
                        flag2 &= k;
                        k = k1;
                        l1 = l;
                        k1 = k3;
                        l = k;
                        k = l1;
                    } else {
                        if (k3 + k1 > 0)
                            k = 1;
                        else
                            k = 0;
                        flag2 &= k;
                        k = l;
                        l = k1;
                        k1 = k3;
                    }
                } else {
                    int i2 = k;
                    k = l;
                    l = i2;
                }
                if (flag2 && k4 != 0)
                    sparsebooleanarray.put(k4, true);
                else
                if (flag3) {
                    sparsebooleanarray.put(k4, false);
                    int l3 = 0;
                    while (l3 < l2)  {
                        MenuItemImpl menuitemimpl2 = (MenuItemImpl)arraylist.get(l3);
                        l1 = j;
                        if (menuitemimpl2.getGroupId() == k4) {
                            l1 = j;
                            if (menuitemimpl2.isActionButton())
                                l1 = j + 1;
                            menuitemimpl2.setIsActionButton(false);
                        }
                        l3++;
                        j = l1;
                    }
                }
                l1 = j;
                if (flag2)
                    l1 = j - 1;
                menuitemimpl1.setIsActionButton(flag2);
                j = l;
                l = l1;
                l1 = k;
                k = k1;
            } else {
                menuitemimpl1.setIsActionButton(false);
                i4 = k;
                k = k1;
                k1 = j;
                l1 = l;
                j = i4;
                l = k1;
            }
            j3 = l2 + 1;
            k1 = k;
            l2 = l;
            l = l1;
            k = j;
            j = l2;
            l2 = j3;
        }
        return true;
    }

    public View getItemView(MenuItemImpl menuitemimpl, View view, ViewGroup viewgroup) {
        View view1 = menuitemimpl.getActionView();
        if (view1 == null || menuitemimpl.hasCollapsibleActionView())
            view1 = getItemView(menuitemimpl, view, viewgroup);
        byte byte0;
        if (menuitemimpl.isActionViewExpanded())
            byte0 = 8;
        else
            byte0 = 0;
        view1.setVisibility(byte0);
        view = (ActionMenuView)viewgroup;
        menuitemimpl = view1.getLayoutParams();
        if (!view.checkLayoutParams(menuitemimpl))
            view1.setLayoutParams(view.generateLayoutParams(menuitemimpl));
        return view1;
    }

    public MenuView getMenuView(ViewGroup viewgroup) {
        MenuView menuview = mMenuView;
        viewgroup = getMenuView(viewgroup);
        if (menuview != viewgroup)
            ((ActionMenuView)viewgroup).setPresenter(this);
        return viewgroup;
    }

    public Drawable getOverflowIcon() {
        Drawable drawable;
        if (mOverflowButton != null)
            drawable = mOverflowButton.getDrawable();
        else
        if (mPendingOverflowIconSet)
            drawable = mPendingOverflowIcon;
        else
            drawable = null;
        return drawable;
    }

    public boolean hideOverflowMenu() {
        boolean flag;
        if (mPostedOpenRunnable != null && mMenuView != null) {
            ((View)mMenuView).removeCallbacks(mPostedOpenRunnable);
            mPostedOpenRunnable = null;
            flag = true;
        } else {
            OverflowPopup overflowpopup = mOverflowPopup;
            if (overflowpopup != null) {
                overflowpopup.dismiss();
                flag = true;
            } else {
                flag = false;
            }
        }
        return flag;
    }

    public boolean hideSubMenus() {
        boolean flag;
        if (mActionButtonPopup != null) {
            mActionButtonPopup.dismiss();
            flag = true;
        } else {
            flag = false;
        }
        return flag;
    }

    public void initForMenu(Context context, MenuBuilder menubuilder) {
        initForMenu(context, menubuilder);
        menubuilder = context.getResources();
        context = ActionBarPolicy.get(context);
        if (!mReserveOverflowSet)
            mReserveOverflow = context.showsOverflowMenuButton();
        if (!mWidthLimitSet)
            mWidthLimit = context.getEmbeddedMenuWidthLimit();
        if (!mMaxItemsSet)
            mMaxItems = context.getMaxActionButtons();
        int i = mWidthLimit;
        if (mReserveOverflow) {
            if (mOverflowButton == null) {
                mOverflowButton = new OverflowMenuButton(mSystemContext);
                if (mPendingOverflowIconSet) {
                    mOverflowButton.setImageDrawable(mPendingOverflowIcon);
                    mPendingOverflowIcon = null;
                    mPendingOverflowIconSet = false;
                }
                int j = android.view.View.MeasureSpec.makeMeasureSpec(0, 0);
                mOverflowButton.measure(j, j);
            }
            i -= mOverflowButton.getMeasuredWidth();
        } else {
            mOverflowButton = null;
        }
        mActionItemWidthLimit = i;
        mMinCellSize = (int)(56F * menubuilder.getDisplayMetrics().density);
        mScrapActionButtonView = null;
    }

    public boolean isOverflowMenuShowPending() {
        boolean flag;
        if (mPostedOpenRunnable != null || isOverflowMenuShowing())
            flag = true;
        else
            flag = false;
        return flag;
    }

    public boolean isOverflowMenuShowing() {
        boolean flag;
        if (mOverflowPopup != null && mOverflowPopup.isShowing())
            flag = true;
        else
            flag = false;
        return flag;
    }

    public boolean isOverflowReserved() {
        return mReserveOverflow;
    }

    public void onCloseMenu(MenuBuilder menubuilder, boolean flag) {
        dismissPopupMenus();
        onCloseMenu(menubuilder, flag);
    }

    public void onConfigurationChanged(Configuration configuration) {
        if (!mMaxItemsSet)
            mMaxItems = ActionBarPolicy.get(mContext).getMaxActionButtons();
        if (mMenu != null)
            mMenu.onItemsChanged(true);
    }

    public void onRestoreInstanceState(Parcelable parcelable) {
        if (parcelable instanceof SavedState) goto _L2; else goto _L1
_L1:
        return;
_L2:
        parcelable = (SavedState)parcelable;
        if (((SavedState) (parcelable)).openSubMenuId > 0) {
            parcelable = mMenu.findItem(((SavedState) (parcelable)).openSubMenuId);
            if (parcelable != null)
                onSubMenuSelected((SubMenuBuilder)parcelable.getSubMenu());
        }
        if (true) goto _L1; else goto _L3
_L3:
    }

    public Parcelable onSaveInstanceState() {
        SavedState savedstate = new SavedState();
        savedstate.openSubMenuId = mOpenSubMenuId;
        return savedstate;
    }

    public boolean onSubMenuSelected(SubMenuBuilder submenubuilder) {
        boolean flag = false;
        if (submenubuilder.hasVisibleItems()) goto _L2; else goto _L1
_L1:
        return flag;
_L2:
        Object obj;
        for (obj = submenubuilder; ((SubMenuBuilder) (obj)).getParentMenu() != mMenu; obj = (SubMenuBuilder)((SubMenuBuilder) (obj)).getParentMenu());
        obj = findViewForItem(((SubMenuBuilder) (obj)).getItem());
        if (obj == null) goto _L1; else goto _L3
_L3:
        int i;
        int j;
        mOpenSubMenuId = submenubuilder.getItem().getItemId();
        j = submenubuilder.size();
        i = 0;
_L6:
        MenuItem menuitem;
        if (i >= j)
            break MISSING_BLOCK_LABEL_165;
        menuitem = submenubuilder.getItem(i);
        if (!menuitem.isVisible() || menuitem.getIcon() == null) goto _L5; else goto _L4
_L4:
        flag = true;
_L7:
        mActionButtonPopup = new ActionButtonSubmenu(mContext, submenubuilder, ((View) (obj)));
        mActionButtonPopup.setForceShowIcon(flag);
        mActionButtonPopup.show();
        onSubMenuSelected(submenubuilder);
        flag = true;
          goto _L1
_L5:
        i++;
          goto _L6
        flag = false;
          goto _L7
    }

    public void onSubUiVisibilityChanged(boolean flag) {
        if (!flag) goto _L2; else goto _L1
_L1:
        onSubMenuSelected(null);
_L4:
        return;
_L2:
        if (mMenu != null)
            mMenu.close(false);
        if (true) goto _L4; else goto _L3
_L3:
    }

    public void setExpandedActionViewsExclusive(boolean flag) {
        mExpandedActionViewsExclusive = flag;
    }

    public void setItemLimit(int i) {
        mMaxItems = i;
        mMaxItemsSet = true;
    }

    public void setMenuView(ActionMenuView actionmenuview) {
        mMenuView = actionmenuview;
        actionmenuview.initialize(mMenu);
    }

    public void setOverflowIcon(Drawable drawable) {
        if (mOverflowButton != null) {
            mOverflowButton.setImageDrawable(drawable);
        } else {
            mPendingOverflowIconSet = true;
            mPendingOverflowIcon = drawable;
        }
    }

    public void setReserveOverflow(boolean flag) {
        mReserveOverflow = flag;
        mReserveOverflowSet = true;
    }

    public void setWidthLimit(int i, boolean flag) {
        mWidthLimit = i;
        mStrictWidthLimit = flag;
        mWidthLimitSet = true;
    }

    public boolean shouldIncludeItem(int i, MenuItemImpl menuitemimpl) {
        return menuitemimpl.isActionButton();
    }

    public boolean showOverflowMenu() {
        boolean flag = true;
        if (mReserveOverflow && !isOverflowMenuShowing() && mMenu != null && mMenuView != null && mPostedOpenRunnable == null && !mMenu.getNonActionItems().isEmpty()) {
            mPostedOpenRunnable = new OpenOverflowRunnable(new OverflowPopup(mContext, mMenu, mOverflowButton, true));
            ((View)mMenuView).post(mPostedOpenRunnable);
            onSubMenuSelected(null);
        } else {
            flag = false;
        }
        return flag;
    }

    public void updateMenuView(boolean flag) {
        boolean flag1 = true;
        boolean flag2 = false;
        Object obj = (ViewGroup)((View)mMenuView).getParent();
        if (obj != null)
            ActionBarTransition.beginDelayedTransition(((ViewGroup) (obj)));
        updateMenuView(flag);
        ((View)mMenuView).requestLayout();
        if (mMenu != null) {
            obj = mMenu.getActionItems();
            int k = ((ArrayList) (obj)).size();
            for (int i = 0; i < k; i++) {
                ActionProvider actionprovider = ((MenuItemImpl)((ArrayList) (obj)).get(i)).getSupportActionProvider();
                if (actionprovider != null)
                    actionprovider.setSubUiVisibilityListener(this);
            }

        }
        int j;
        if (mMenu != null)
            obj = mMenu.getNonActionItems();
        else
            obj = null;
        j = ((flag2) ? 1 : 0);
        if (mReserveOverflow) {
            j = ((flag2) ? 1 : 0);
            if (obj != null) {
                j = ((ArrayList) (obj)).size();
                if (j == 1) {
                    if (!((MenuItemImpl)((ArrayList) (obj)).get(0)).isActionViewExpanded())
                        j = 1;
                    else
                        j = 0;
                } else
                if (j > 0)
                    j = ((flag1) ? 1 : 0);
                else
                    j = 0;
            }
        }
        if (j == 0) goto _L2; else goto _L1
_L1:
        if (mOverflowButton == null)
            mOverflowButton = new OverflowMenuButton(mSystemContext);
        obj = (ViewGroup)mOverflowButton.getParent();
        if (obj != mMenuView) {
            if (obj != null)
                ((ViewGroup) (obj)).removeView(mOverflowButton);
            obj = (ActionMenuView)mMenuView;
            ((ActionMenuView) (obj)).addView(mOverflowButton, ((ActionMenuView) (obj)).generateOverflowButtonLayoutParams());
        }
_L4:
        ((ActionMenuView)mMenuView).setOverflowReserved(mReserveOverflow);
        return;
_L2:
        if (mOverflowButton != null && mOverflowButton.getParent() == mMenuView)
            ((ViewGroup)mMenuView).removeView(mOverflowButton);
        if (true) goto _L4; else goto _L3
_L3:
    }







    // Unreferenced inner class android/support/v7/widget/ActionMenuPresenter$OverflowMenuButton$1

/* anonymous class */
    class OverflowMenuButton._cls1 extends ForwardingListener {

        final OverflowMenuButton this$1;
        final ActionMenuPresenter val$this$0;

        public ShowableListMenu getPopup() {
            Object obj;
            if (mOverflowPopup == null)
                obj = null;
            else
                obj = mOverflowPopup.getPopup();
            return ((ShowableListMenu) (obj));
        }

        public boolean onForwardingStarted() {
            showOverflowMenu();
            return true;
        }

        public boolean onForwardingStopped() {
            boolean flag;
            if (mPostedOpenRunnable != null) {
                flag = false;
            } else {
                hideOverflowMenu();
                flag = true;
            }
            return flag;
        }

             {
                this$1 = final_overflowmenubutton;
                this$0 = actionmenupresenter;
                ForwardingListener(View.this);
            }
    }

}
