// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.kpdus.com/jad.html
// Decompiler options: packimports(3) fieldsfirst nonlb space 

package com.fasterxml.jackson.core.json;

import com.fasterxml.jackson.core.*;
import com.fasterxml.jackson.core.format.InputAccessor;
import com.fasterxml.jackson.core.format.MatchStrength;
import com.fasterxml.jackson.core.io.*;
import com.fasterxml.jackson.core.sym.ByteQuadsCanonicalizer;
import com.fasterxml.jackson.core.sym.CharsToNameCanonicalizer;
import java.io.*;

// Referenced classes of package com.fasterxml.jackson.core.json:
//            UTF8StreamJsonParser, ReaderBasedJsonParser

public final class ByteSourceJsonBootstrapper {

    static final byte UTF8_BOM_1 = -17;
    static final byte UTF8_BOM_2 = -69;
    static final byte UTF8_BOM_3 = -65;
    protected boolean _bigEndian;
    private final boolean _bufferRecyclable;
    protected int _bytesPerChar;
    protected final IOContext _context;
    protected final InputStream _in;
    protected final byte _inputBuffer[];
    private int _inputEnd;
    protected int _inputProcessed;
    private int _inputPtr;

    public ByteSourceJsonBootstrapper(IOContext iocontext, InputStream inputstream) {
        _bigEndian = true;
        _context = iocontext;
        _in = inputstream;
        _inputBuffer = iocontext.allocReadIOBuffer();
        _inputPtr = 0;
        _inputEnd = 0;
        _inputProcessed = 0;
        _bufferRecyclable = true;
    }

    public ByteSourceJsonBootstrapper(IOContext iocontext, byte abyte0[], int i, int j) {
        _bigEndian = true;
        _context = iocontext;
        _in = null;
        _inputBuffer = abyte0;
        _inputPtr = i;
        _inputEnd = i + j;
        _inputProcessed = -i;
        _bufferRecyclable = false;
    }

    private boolean checkUTF16(int i) {
        boolean flag = false;
        if ((0xff00 & i) != 0) goto _L2; else goto _L1
_L1:
        _bigEndian = true;
_L6:
        _bytesPerChar = 2;
        flag = true;
_L4:
        return flag;
_L2:
        if ((i & 0xff) != 0) goto _L4; else goto _L3
_L3:
        _bigEndian = false;
        if (true) goto _L6; else goto _L5
_L5:
    }

    private boolean checkUTF32(int i) {
        boolean flag = false;
        if (i >> 8 == 0)
            _bigEndian = true;
        else
        if ((0xffffff & i) == 0) {
            _bigEndian = false;
        } else {
            if ((0xff00ffff & i) != 0)
                continue;
            reportWeirdUCS4("3412");
        }
        do {
            _bytesPerChar = 4;
            flag = true;
            do
                return flag;
            while ((0xffff00ff & i) != 0);
            reportWeirdUCS4("2143");
        } while (true);
    }

    private boolean handleBOM(int i) {
        boolean flag = true;
        i;
        JVM INSTR lookupswitch 4: default 44
    //                   -16842752: 129
    //                   -131072: 100
    //                   65279: 77
    //                   65534: 123;
           goto _L1 _L2 _L3 _L4 _L5
_L2:
        break MISSING_BLOCK_LABEL_129;
_L1:
        int j = i >>> 16;
        if (j == 65279) {
            _inputPtr = _inputPtr + 2;
            _bytesPerChar = 2;
            _bigEndian = true;
        } else
        if (j == 65534) {
            _inputPtr = _inputPtr + 2;
            _bytesPerChar = 2;
            _bigEndian = false;
        } else
        if (i >>> 8 == 0xefbbbf) {
            _inputPtr = _inputPtr + 3;
            _bytesPerChar = 1;
            _bigEndian = true;
        } else {
            flag = false;
        }
_L6:
        return flag;
_L4:
        _bigEndian = true;
        _inputPtr = _inputPtr + 4;
        _bytesPerChar = 4;
        continue; /* Loop/switch isn't completed */
_L3:
        _inputPtr = _inputPtr + 4;
        _bytesPerChar = 4;
        _bigEndian = false;
        if (true) goto _L6; else goto _L5
_L5:
        reportWeirdUCS4("2143");
        reportWeirdUCS4("3412");
          goto _L1
    }

    public static MatchStrength hasJSONFormat(InputAccessor inputaccessor) {
        if (inputaccessor.hasMoreBytes()) goto _L2; else goto _L1
_L1:
        MatchStrength matchstrength = MatchStrength.INCONCLUSIVE;
_L4:
        return matchstrength;
_L2:
        byte byte1 = inputaccessor.nextByte();
        byte byte0 = byte1;
        if (byte1 == -17) {
            if (!inputaccessor.hasMoreBytes()) {
                matchstrength = MatchStrength.INCONCLUSIVE;
                continue; /* Loop/switch isn't completed */
            }
            if (inputaccessor.nextByte() != -69) {
                matchstrength = MatchStrength.NO_MATCH;
                continue; /* Loop/switch isn't completed */
            }
            if (!inputaccessor.hasMoreBytes()) {
                matchstrength = MatchStrength.INCONCLUSIVE;
                continue; /* Loop/switch isn't completed */
            }
            if (inputaccessor.nextByte() != -65) {
                matchstrength = MatchStrength.NO_MATCH;
                continue; /* Loop/switch isn't completed */
            }
            if (!inputaccessor.hasMoreBytes()) {
                matchstrength = MatchStrength.INCONCLUSIVE;
                continue; /* Loop/switch isn't completed */
            }
            byte0 = inputaccessor.nextByte();
        }
        int i = skipSpace(inputaccessor, byte0);
        if (i < 0) {
            matchstrength = MatchStrength.INCONCLUSIVE;
            continue; /* Loop/switch isn't completed */
        }
        if (i == 123) {
            i = skipSpace(inputaccessor);
            if (i < 0)
                matchstrength = MatchStrength.INCONCLUSIVE;
            else
            if (i == 34 || i == 125)
                matchstrength = MatchStrength.SOLID_MATCH;
            else
                matchstrength = MatchStrength.NO_MATCH;
            continue; /* Loop/switch isn't completed */
        }
        if (i == 91) {
            i = skipSpace(inputaccessor);
            if (i < 0)
                matchstrength = MatchStrength.INCONCLUSIVE;
            else
            if (i == 93 || i == 91)
                matchstrength = MatchStrength.SOLID_MATCH;
            else
                matchstrength = MatchStrength.SOLID_MATCH;
            continue; /* Loop/switch isn't completed */
        }
        MatchStrength matchstrength1 = MatchStrength.WEAK_MATCH;
        matchstrength = matchstrength1;
        if (i == 34)
            continue; /* Loop/switch isn't completed */
        if (i <= 57) {
            matchstrength = matchstrength1;
            if (i >= 48)
                continue; /* Loop/switch isn't completed */
        }
        if (i == 45) {
            i = skipSpace(inputaccessor);
            if (i < 0) {
                matchstrength = MatchStrength.INCONCLUSIVE;
                continue; /* Loop/switch isn't completed */
            }
            if (i <= 57) {
                matchstrength = matchstrength1;
                if (i >= 48)
                    continue; /* Loop/switch isn't completed */
            }
            matchstrength = MatchStrength.NO_MATCH;
        } else
        if (i == 110)
            matchstrength = tryMatch(inputaccessor, "ull", matchstrength1);
        else
        if (i == 116)
            matchstrength = tryMatch(inputaccessor, "rue", matchstrength1);
        else
        if (i == 102)
            matchstrength = tryMatch(inputaccessor, "alse", matchstrength1);
        else
            matchstrength = MatchStrength.NO_MATCH;
        if (true) goto _L4; else goto _L3
_L3:
    }

    private void reportWeirdUCS4(String s) {
        throw new CharConversionException((new StringBuilder()).append("Unsupported UCS-4 endianness (").append(s).append(") detected").toString());
    }

    private static int skipSpace(InputAccessor inputaccessor) {
        int i;
        if (!inputaccessor.hasMoreBytes())
            i = -1;
        else
            i = skipSpace(inputaccessor, inputaccessor.nextByte());
        return i;
    }

    private static int skipSpace(InputAccessor inputaccessor, byte byte0) {
_L5:
        byte0 &= 0xff;
        if (byte0 == 32 || byte0 == 13 || byte0 == 10 || byte0 == 9) goto _L2; else goto _L1
_L1:
        return byte0;
_L2:
        if (inputaccessor.hasMoreBytes())
            break; /* Loop/switch isn't completed */
        byte0 = -1;
        if (true) goto _L1; else goto _L3
_L3:
        byte0 = inputaccessor.nextByte();
        if (true) goto _L5; else goto _L4
_L4:
    }

    private static MatchStrength tryMatch(InputAccessor inputaccessor, String s, MatchStrength matchstrength) {
        int i;
        int j;
        i = 0;
        j = s.length();
_L7:
        MatchStrength matchstrength1 = matchstrength;
        if (i >= j) goto _L2; else goto _L1
_L1:
        if (inputaccessor.hasMoreBytes()) goto _L4; else goto _L3
_L3:
        matchstrength1 = MatchStrength.INCONCLUSIVE;
_L2:
        return matchstrength1;
_L4:
        if (inputaccessor.nextByte() == s.charAt(i))
            break; /* Loop/switch isn't completed */
        matchstrength1 = MatchStrength.NO_MATCH;
        if (true) goto _L2; else goto _L5
_L5:
        i++;
        if (true) goto _L7; else goto _L6
_L6:
    }

    public JsonParser constructParser(int i, ObjectCodec objectcodec, ByteQuadsCanonicalizer bytequadscanonicalizer, CharsToNameCanonicalizer charstonamecanonicalizer, int j) {
        if (detectEncoding() == JsonEncoding.UTF8 && com.fasterxml.jackson.core.JsonFactory.Feature.CANONICALIZE_FIELD_NAMES.enabledIn(j)) {
            bytequadscanonicalizer = bytequadscanonicalizer.makeChild(j);
            objectcodec = new UTF8StreamJsonParser(_context, i, _in, objectcodec, bytequadscanonicalizer, _inputBuffer, _inputPtr, _inputEnd, _bufferRecyclable);
        } else {
            objectcodec = new ReaderBasedJsonParser(_context, i, constructReader(), objectcodec, charstonamecanonicalizer.makeChild(j));
        }
        return objectcodec;
    }

    public Reader constructReader() {
        JsonEncoding jsonencoding = _context.getEncoding();
        jsonencoding.bits();
        JVM INSTR lookupswitch 3: default 48
    //                   8: 58
    //                   16: 58
    //                   32: 141;
           goto _L1 _L2 _L2 _L3
_L1:
        throw new RuntimeException("Internal error");
_L2:
        Object obj;
        obj = _in;
        if (obj == null)
            obj = new ByteArrayInputStream(_inputBuffer, _inputPtr, _inputEnd);
        else
        if (_inputPtr < _inputEnd)
            obj = new MergedStream(_context, ((InputStream) (obj)), _inputBuffer, _inputPtr, _inputEnd);
        obj = new InputStreamReader(((InputStream) (obj)), jsonencoding.getJavaName());
_L5:
        return ((Reader) (obj));
_L3:
        obj = new UTF32Reader(_context, _in, _inputBuffer, _inputPtr, _inputEnd, _context.getEncoding().isBigEndian());
        if (true) goto _L5; else goto _L4
_L4:
    }

    public JsonEncoding detectEncoding() {
        boolean flag1 = true;
        if (!ensureLoaded(4)) goto _L2; else goto _L1
_L1:
        int i = _inputBuffer[_inputPtr] << 24 | (_inputBuffer[_inputPtr + 1] & 0xff) << 16 | (_inputBuffer[_inputPtr + 2] & 0xff) << 8 | _inputBuffer[_inputPtr + 3] & 0xff;
        if (!handleBOM(i)) goto _L4; else goto _L3
_L3:
        boolean flag = flag1;
_L12:
        if (flag) goto _L6; else goto _L5
_L5:
        JsonEncoding jsonencoding = JsonEncoding.UTF8;
_L10:
        _context.setEncoding(jsonencoding);
        return jsonencoding;
_L4:
        flag = flag1;
        if (checkUTF32(i))
            continue; /* Loop/switch isn't completed */
        flag = flag1;
        if (checkUTF16(i >>> 16))
            continue; /* Loop/switch isn't completed */
_L8:
        flag = false;
        continue; /* Loop/switch isn't completed */
_L2:
        if (!ensureLoaded(2) || !checkUTF16((_inputBuffer[_inputPtr] & 0xff) << 8 | _inputBuffer[_inputPtr + 1] & 0xff)) goto _L8; else goto _L7
_L7:
        flag = flag1;
        continue; /* Loop/switch isn't completed */
_L6:
        switch (_bytesPerChar) {
        case 3: // '\003'
        default:
            throw new RuntimeException("Internal error");

        case 1: // '\001'
            jsonencoding = JsonEncoding.UTF8;
            break;

        case 2: // '\002'
            if (_bigEndian)
                jsonencoding = JsonEncoding.UTF16_BE;
            else
                jsonencoding = JsonEncoding.UTF16_LE;
            break;

        case 4: // '\004'
            if (_bigEndian)
                jsonencoding = JsonEncoding.UTF32_BE;
            else
                jsonencoding = JsonEncoding.UTF32_LE;
            break;
        }
        if (true) goto _L10; else goto _L9
_L9:
        if (true) goto _L12; else goto _L11
_L11:
    }

    protected boolean ensureLoaded(int i) {
        boolean flag1 = true;
        int j = _inputEnd - _inputPtr;
        do {
            int k;
label0:
            {
                boolean flag = flag1;
                if (j < i) {
                    if (_in == null)
                        k = -1;
                    else
                        k = _in.read(_inputBuffer, _inputEnd, _inputBuffer.length - _inputEnd);
                    if (k >= 1)
                        break label0;
                    flag = false;
                }
                return flag;
            }
            _inputEnd = _inputEnd + k;
            j = k + j;
        } while (true);
    }
}
