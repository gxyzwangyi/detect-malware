// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.kpdus.com/jad.html
// Decompiler options: packimports(3) fieldsfirst nonlb space 

package com.tencent.bugly.beta.upgrade;

import android.os.Handler;
import android.os.Looper;
import android.os.Parcel;
import android.os.Parcelable;
import android.text.TextUtils;
import com.tencent.bugly.beta.Beta;
import com.tencent.bugly.beta.download.BetaReceiver;
import com.tencent.bugly.beta.download.DownloadListener;
import com.tencent.bugly.beta.download.DownloadTask;
import com.tencent.bugly.beta.download.a;
import com.tencent.bugly.beta.download.b;
import com.tencent.bugly.beta.global.d;
import com.tencent.bugly.beta.global.e;
import com.tencent.bugly.beta.ui.g;
import com.tencent.bugly.proguard.ag;
import com.tencent.bugly.proguard.ay;
import com.tencent.bugly.proguard.az;
import com.tencent.bugly.proguard.l;
import com.tencent.bugly.proguard.o;
import com.tencent.bugly.proguard.p;
import com.tencent.bugly.proguard.q;
import com.tencent.bugly.proguard.s;
import com.tencent.bugly.proguard.t;
import java.io.File;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

// Referenced classes of package com.tencent.bugly.beta.upgrade:
//            BetaUploadStrategy, BetaGrayStrategy, a, b, 
//            UpgradeListener, UpgradeStateListener

public final class c {

    public static final c a = new c();
    public BetaGrayStrategy b;
    public DownloadTask c;
    public UpgradeListener d;
    public UpgradeStateListener e;
    public boolean f;
    public com.tencent.bugly.beta.global.c g;
    public com.tencent.bugly.beta.global.c h;
    private Handler i;
    private Object j;
    private final Object k = new Object();
    private DownloadListener l;
    private com.tencent.bugly.beta.upgrade.a m;
    private com.tencent.bugly.beta.global.c n;
    private boolean o;

    public c() {
        i = new Handler(Looper.getMainLooper());
        j = new Object();
        l = new a(3, new Object[] {
            this, Integer.valueOf(0)
        });
        m = null;
    }

    public static void a(az az1) {
        if (d.D.E == null)
            d.D.E = new BetaUploadStrategy();
        if (az1 != null && d.D.E.b != az1.h) {
            d.D.E.b = az1.h;
            d.D.E.a.b = az1.b;
            d.D.E.a.c = az1.c;
            d.D.E.a.h = az1.h;
            if (com.tencent.bugly.proguard.a.c(az1.d))
                d.D.E.a.d = az1.d;
            if (com.tencent.bugly.proguard.a.c(az1.e))
                d.D.E.a.e = az1.e;
            if (az1.f != null && !TextUtils.isEmpty(az1.f.a))
                d.D.E.a.f.a = az1.f.a;
            if (az1.g != null && az1.g.size() > 0)
                d.D.E.a.g = az1.g;
            if (com.tencent.bugly.proguard.a.c(az1.i))
                d.D.E.a.i = az1.i;
            if (com.tencent.bugly.proguard.a.c(az1.j))
                d.D.E.a.j = az1.j;
            com.tencent.bugly.proguard.a.a("us.bch", d.D.E);
        }
    }

    private void a(boolean flag) {
        boolean flag1;
        s s1;
        flag1 = false;
        if (b == null)
            s1 = null;
        else
            s1 = b.a;
        if (s1 != null) goto _L2; else goto _L1
_L1:
        return;
_L2:
        g g1;
        e e1;
label0:
        {
            e.a.a(d.D.o, s1.j);
            if (c == null)
                c = d.D.o.a(s1.f.b, d.D.s.getAbsolutePath(), null, b.a.f.a);
            if (c == null)
                continue; /* Loop/switch isn't completed */
            if (!flag && c.getStatus() == 2) {
                ag.a("Task is downloading %s %s", new Object[] {
                    s1.k, c.getDownloadUrl()
                });
                continue; /* Loop/switch isn't completed */
            }
            c.addListener(l);
            g1 = g.p;
            g1.a(s1, c);
            g1.m = new com.tencent.bugly.beta.global.c(3, new Object[] {
                b, c
            });
            g1.n = new com.tencent.bugly.beta.global.c(4, new Object[] {
                b, c, Boolean.valueOf(flag)
            });
            b.c = System.currentTimeMillis();
            com.tencent.bugly.proguard.a.a("st.bch", b);
            if (flag) {
                e.a.a(new com.tencent.bugly.beta.global.c(2, new Object[] {
                    g1, Boolean.valueOf(flag)
                }), 3000);
                continue; /* Loop/switch isn't completed */
            }
            e1 = e.a;
            if (!flag) {
                flag = flag1;
                if (s1.g != 2)
                    break label0;
            }
            flag = true;
        }
        e1.a(new com.tencent.bugly.beta.global.c(2, new Object[] {
            g1, Boolean.valueOf(flag)
        }));
        if (true) goto _L1; else goto _L3
_L3:
    }

    public final BetaGrayStrategy a(s s1) {
        Object obj3 = j;
        obj3;
        JVM INSTR monitorenter ;
        Object obj = (BetaGrayStrategy)com.tencent.bugly.proguard.a.a("st.bch", BetaGrayStrategy.CREATOR);
        Object obj1;
        obj1 = obj;
        if (obj == null)
            break MISSING_BLOCK_LABEL_52;
        obj1 = obj;
        if (((BetaGrayStrategy) (obj)).a != null)
            break MISSING_BLOCK_LABEL_52;
        com.tencent.bugly.proguard.a.b("st.bch");
        obj1 = null;
        obj = obj1;
        if (obj1 == null)
            break MISSING_BLOCK_LABEL_156;
        obj = obj1;
        if (((BetaGrayStrategy) (obj1)).a == null)
            break MISSING_BLOCK_LABEL_156;
        if (((BetaGrayStrategy) (obj1)).a.e.a < d.D.v || ((BetaGrayStrategy) (obj1)).a.l != 1)
            break MISSING_BLOCK_LABEL_147;
        obj = obj1;
        if (((BetaGrayStrategy) (obj1)).a.f == null)
            break MISSING_BLOCK_LABEL_156;
        obj = obj1;
        if (!TextUtils.equals(d.D.u, ((BetaGrayStrategy) (obj1)).a.f.a))
            break MISSING_BLOCK_LABEL_156;
        com.tencent.bugly.proguard.a.b("st.bch");
        obj = null;
        if (s1 == null) goto _L2; else goto _L1
_L1:
        if (s1.e.a >= d.D.v) goto _L2; else goto _L3
_L3:
        ag.a("versionCode is too small, discard remote strategy: [new: %d] [current: %d]", new Object[] {
            Integer.valueOf(s1.e.a), Integer.valueOf(d.D.v)
        });
        obj1 = null;
_L19:
        Object obj2 = obj;
        if (obj1 == null) goto _L5; else goto _L4
_L4:
        s1 = ((s) (obj));
        if (((s) (obj1)).l != 2)
            break MISSING_BLOCK_LABEL_372;
        s1 = ((s) (obj));
        if (obj == null)
            break MISSING_BLOCK_LABEL_372;
        s1 = ((s) (obj));
        if (((BetaGrayStrategy) (obj)).a == null)
            break MISSING_BLOCK_LABEL_372;
        s1 = ((s) (obj));
        if (TextUtils.isEmpty(((s) (obj1)).k))
            break MISSING_BLOCK_LABEL_372;
        s1 = ((s) (obj));
        if (TextUtils.isEmpty(((BetaGrayStrategy) (obj)).a.k))
            break MISSING_BLOCK_LABEL_372;
        s1 = ((s) (obj));
        if (!TextUtils.equals(((s) (obj1)).k, ((BetaGrayStrategy) (obj)).a.k))
            break MISSING_BLOCK_LABEL_372;
        ag.a("callback strategy: %s", new Object[] {
            ((s) (obj1)).k
        });
        com.tencent.bugly.proguard.a.b("st.bch");
        d.D.o.a(((BetaGrayStrategy) (obj)).a.f.b, d.D.s.getAbsolutePath(), null, null).delete(true);
        s1 = null;
        obj2 = s1;
        if (((s) (obj1)).l == 1) goto _L5; else goto _L6
_L6:
        ag.a("invalid strategy: %s", new Object[] {
            ((s) (obj1)).k
        });
        obj1 = null;
_L17:
        obj = s1;
        if (obj1 == null)
            break MISSING_BLOCK_LABEL_846;
        if (s1 == null) goto _L8; else goto _L7
_L7:
        if (((BetaGrayStrategy) (s1)).a == null || TextUtils.isEmpty(((s) (obj1)).k) || TextUtils.isEmpty(((BetaGrayStrategy) (s1)).a.k) || !TextUtils.equals(((s) (obj1)).k, ((BetaGrayStrategy) (s1)).a.k)) goto _L8; else goto _L9
_L9:
        obj = JVM INSTR new #145 <Class BetaGrayStrategy>;
        Parcel parcel = Parcel.obtain();
        s1.writeToParcel(parcel, 0);
        obj2 = parcel.marshall();
        parcel.recycle();
        parcel = Parcel.obtain();
        parcel.unmarshall(((byte []) (obj2)), 0, obj2.length);
        parcel.setDataPosition(0);
        ((BetaGrayStrategy) (obj)).BetaGrayStrategy(parcel);
        ag.a("same strategyId:[new: %s] [current: %s] keep has popup times: %d, interval: %d", new Object[] {
            ((s) (obj1)).k, ((BetaGrayStrategy) (s1)).a.k, Integer.valueOf(((BetaGrayStrategy) (obj)).b), Long.valueOf(((s) (obj1)).i)
        });
_L16:
        obj.a = ((s) (obj1));
        obj.e = System.currentTimeMillis();
        if (s1 == null) goto _L11; else goto _L10
_L10:
        if (((BetaGrayStrategy) (s1)).a.f.b.equals(((s) (obj1)).f.b)) goto _L11; else goto _L12
_L12:
        if (c != null) goto _L14; else goto _L13
_L13:
        int j1;
        d.D.o.a(((BetaGrayStrategy) (s1)).a.f.b, d.D.s.getAbsolutePath(), null, null).delete(true);
        obj2 = d.D.s.listFiles();
        j1 = obj2.length;
        int i1 = 0;
_L15:
        if (i1 >= j1)
            break; /* Loop/switch isn't completed */
        s1 = ((s) (obj2[i1]));
        if (!s1.delete())
            ag.e("cannot deleteCache file:%s", new Object[] {
                s1.getAbsolutePath()
            });
        i1++;
        if (true) goto _L15; else goto _L11
_L8:
        obj = new BetaGrayStrategy();
          goto _L16
        s1;
        throw s1;
_L14:
        BetaReceiver.netListeners.remove(c.getDownloadUrl());
        c.delete(true);
        c = null;
_L11:
        com.tencent.bugly.proguard.a.a("st.bch", ((Parcelable) (obj)));
        ag.a("onUpgradeReceived: %s [type: %d]", new Object[] {
            obj1, Integer.valueOf(((s) (obj1)).g)
        });
        obj2 = l.a;
        s1 = JVM INSTR new #370 <Class q>;
        s1.q("rcv", System.currentTimeMillis(), (byte)0, 0L, ((s) (obj1)).e, ((s) (obj1)).k, ((s) (obj1)).n, null);
        ((l) (obj2)).a(s1);
        obj3;
        JVM INSTR monitorexit ;
        return ((BetaGrayStrategy) (obj));
_L5:
        s1 = ((s) (obj2));
        if (true) goto _L17; else goto _L2
_L2:
        obj1 = s1;
        if (true) goto _L19; else goto _L18
_L18:
    }

    public final void a(boolean flag, boolean flag1) {
        int i1 = 1;
        Object obj3 = k;
        obj3;
        JVM INSTR monitorenter ;
        b = a(((s) (null)));
        if (m != null && !m.c && o == flag) goto _L2; else goto _L1
_L1:
        o = flag;
        if (m != null)
            m.c = true;
        Object obj = JVM INSTR new #387 <Class com.tencent.bugly.beta.upgrade.a>;
        ((com.tencent.bugly.beta.upgrade.a) (obj)).com.tencent.bugly.beta.upgrade.a(1, 804, new Object[] {
            Boolean.valueOf(flag), Boolean.valueOf(flag1)
        });
        m = ((com.tencent.bugly.beta.upgrade.a) (obj));
        obj = JVM INSTR new #220 <Class com.tencent.bugly.beta.global.c>;
        ((com.tencent.bugly.beta.global.c) (obj)).com.tencent.bugly.beta.global.c(12, new Object[] {
            Boolean.valueOf(false), m
        });
        n = ((com.tencent.bugly.beta.global.c) (obj));
        long l1;
        long l2;
        String s1;
        Object obj2;
        obj2 = "";
        l2 = 0L;
        s1 = ((String) (obj2));
        l1 = l2;
        if (b == null)
            break MISSING_BLOCK_LABEL_204;
        s1 = ((String) (obj2));
        l1 = l2;
        if (b.a != null) {
            s1 = b.a.k;
            l1 = b.a.m;
        }
        obj2 = JVM INSTR new #401 <Class t>;
        byte abyte0[];
        if (!flag)
            i1 = 0;
        ((t) (obj2)).t(i1, s1, l1, null);
        abyte0 = com.tencent.bugly.proguard.a.a(((com.tencent.bugly.proguard.j) (obj2)));
        com.tencent.bugly.beta.upgrade.b.a.a(804, abyte0, m, flag, d.D.E.a.e);
_L4:
        if (flag && !flag1)
            break MISSING_BLOCK_LABEL_298;
        if (b == null || b.a == null || b.a.g != 2)
            break MISSING_BLOCK_LABEL_324;
        i.removeCallbacks(n);
        i.postDelayed(n, 6000L);
        obj3;
        JVM INSTR monitorexit ;
        return;
        Object obj1;
        obj1;
        if (!ag.b(((Throwable) (obj1))))
            ((Throwable) (obj1)).printStackTrace();
        continue; /* Loop/switch isn't completed */
        obj1;
        throw obj1;
_L2:
        synchronized (m) {
            m.b[0] = Boolean.valueOf(flag);
            m.b[1] = Boolean.valueOf(flag1);
        }
        n.a[0] = Boolean.valueOf(false);
        if (true) goto _L4; else goto _L3
_L3:
        exception;
        a1;
        JVM INSTR monitorexit ;
        throw exception;
    }

    public final void a(boolean flag, boolean flag1, int i1, s s1) {
        Object obj = j;
        obj;
        JVM INSTR monitorenter ;
        b = a(s1);
        f = flag;
        if (d == null) goto _L2; else goto _L1
_L1:
        ag.a("\u4F60\u5DF2\u653E\u5F03\u8BA9SDK\u6765\u5904\u7406\u7B56\u7565", new Object[0]);
        if (b == null)
            ag.a("betaStrategy is null", new Object[0]);
        if (b != null && c == null)
            c = d.D.o.a(b.a.f.b, d.D.s.getAbsolutePath(), null, b.a.f.a);
        if (c != null) goto _L4; else goto _L3
_L3:
        ag.a("\u7528\u6237\u81EA\u5B9A\u4E49activity\uFF0C\u521B\u5EFAtask\u5931\u8D25 [strategy:%s]", new Object[] {
            b
        });
        b = null;
        com.tencent.bugly.proguard.a.b("st.bch");
_L10:
        s1 = i;
        com.tencent.bugly.beta.global.c c1 = JVM INSTR new #220 <Class com.tencent.bugly.beta.global.c>;
        c1.com.tencent.bugly.beta.global.c(16, new Object[] {
            d, Integer.valueOf(i1), b, Boolean.valueOf(flag), Boolean.valueOf(flag1)
        });
        s1.post(c1);
_L2:
        if (i1 == 0 || !flag || flag1) goto _L6; else goto _L5
_L5:
        if (b != null) goto _L6; else goto _L7
_L7:
        if (e == null) goto _L9; else goto _L8
_L8:
        s1 = i;
        com.tencent.bugly.beta.global.c c2 = JVM INSTR new #220 <Class com.tencent.bugly.beta.global.c>;
        c2.com.tencent.bugly.beta.global.c(18, new Object[] {
            e, Integer.valueOf(-1), Boolean.valueOf(flag)
        });
        s1.post(c2);
_L11:
        obj;
        JVM INSTR monitorexit ;
_L16:
        return;
_L4:
        c.addListener(l);
          goto _L10
        s1;
        throw s1;
_L9:
        s1 = i;
        com.tencent.bugly.beta.global.c c3 = JVM INSTR new #220 <Class com.tencent.bugly.beta.global.c>;
        c3.com.tencent.bugly.beta.global.c(5, new Object[] {
            Beta.strToastCheckUpgradeError, Integer.valueOf(1)
        });
        s1.post(c3);
          goto _L11
_L6:
        if (b == null || b.a == null) goto _L13; else goto _L12
_L12:
        if (e != null) {
            s1 = i;
            com.tencent.bugly.beta.global.c c4 = JVM INSTR new #220 <Class com.tencent.bugly.beta.global.c>;
            c4.com.tencent.bugly.beta.global.c(18, new Object[] {
                e, Integer.valueOf(0), Boolean.valueOf(flag)
            });
            s1.post(c4);
        }
        if (d == null) goto _L15; else goto _L14
_L14:
        obj;
        JVM INSTR monitorexit ;
          goto _L16
_L15:
        if (flag) goto _L18; else goto _L17
_L17:
        if (b.a.g == 2) goto _L18; else goto _L19
_L19:
        if (!b.d || !d.D.e) goto _L21; else goto _L20
_L20:
        if (flag1)
            break MISSING_BLOCK_LABEL_508;
        a(flag);
        obj;
        JVM INSTR monitorexit ;
          goto _L16
_L21:
        if (b.c + b.a.i <= System.currentTimeMillis() && b.a.h - b.b > 0 && b.a.g != 3) goto _L18; else goto _L22
_L22:
        obj;
        JVM INSTR monitorexit ;
          goto _L16
_L18:
        if (flag1)
            break MISSING_BLOCK_LABEL_589;
        a(flag);
_L24:
        obj;
        JVM INSTR monitorexit ;
          goto _L16
_L13:
        if (!flag || flag1) goto _L24; else goto _L23
_L23:
label0:
        {
            if (e == null)
                break label0;
            Handler handler = i;
            s1 = JVM INSTR new #220 <Class com.tencent.bugly.beta.global.c>;
            s1.com.tencent.bugly.beta.global.c(18, new Object[] {
                e, Integer.valueOf(1), Boolean.valueOf(flag)
            });
            handler.post(s1);
        }
          goto _L24
        Handler handler1 = i;
        s1 = JVM INSTR new #220 <Class com.tencent.bugly.beta.global.c>;
        s1.com.tencent.bugly.beta.global.c(5, new Object[] {
            Beta.strToastYourAreTheLatestVersion, Integer.valueOf(1)
        });
        handler1.post(s1);
          goto _L24
    }

}
