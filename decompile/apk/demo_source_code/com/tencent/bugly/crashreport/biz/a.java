// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.kpdus.com/jad.html
// Decompiler options: packimports(3) fieldsfirst nonlb space 

package com.tencent.bugly.crashreport.biz;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.os.Parcel;
import android.os.Parcelable;
import com.tencent.bugly.crashreport.common.strategy.StrategyBean;
import com.tencent.bugly.proguard.ac;
import com.tencent.bugly.proguard.ad;
import com.tencent.bugly.proguard.af;
import com.tencent.bugly.proguard.ag;
import com.tencent.bugly.proguard.ax;
import com.tencent.bugly.proguard.y;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

// Referenced classes of package com.tencent.bugly.crashreport.biz:
//            UserInfoBean

public final class com.tencent.bugly.crashreport.biz.a {
    final class a
        implements Runnable {

        private boolean a;
        private UserInfoBean b;
        private com.tencent.bugly.crashreport.biz.a c;

        public final void run() {
            UserInfoBean userinfobean;
            if (b == null)
                break MISSING_BLOCK_LABEL_54;
            userinfobean = b;
            if (userinfobean == null)
                break MISSING_BLOCK_LABEL_32;
            com.tencent.bugly.crashreport.common.info.a a1 = com.tencent.bugly.crashreport.common.info.a.a();
            if (a1 == null)
                break MISSING_BLOCK_LABEL_32;
            userinfobean.j = a1.d();
            ag.c("record userinfo", new Object[0]);
            com.tencent.bugly.crashreport.biz.a.a(c, b, false);
            if (a)
                c.a(true);
_L1:
            return;
            Throwable throwable;
            throwable;
            if (!ag.a(throwable))
                throwable.printStackTrace();
              goto _L1
        }

        public a(UserInfoBean userinfobean, boolean flag) {
            c = com.tencent.bugly.crashreport.biz.a.this;
            super();
            b = userinfobean;
            a = flag;
        }
    }

    final class b
        implements Runnable {

        private com.tencent.bugly.crashreport.biz.a a;

        public final void run() {
            long l = System.currentTimeMillis();
            if (l < com.tencent.bugly.crashreport.biz.a.a(a)) {
                af.a().a(a. new b(), (com.tencent.bugly.crashreport.biz.a.a(a) - l) + 5000L);
            } else {
                a.a(3, false, 0L);
                a.a();
            }
        }

        b() {
            a = com.tencent.bugly.crashreport.biz.a.this;
            super();
        }
    }

    final class c
        implements Runnable {

        private long a;
        private com.tencent.bugly.crashreport.biz.a b;

        public final void run() {
            b.a(true);
            com.tencent.bugly.crashreport.biz.a a1 = b;
            long l = a;
            af.a().a(a1. new c(l), l);
        }

        public c(long l) {
            b = com.tencent.bugly.crashreport.biz.a.this;
            super();
            a = 0x1499700L;
            a = l;
        }
    }


    private Context a;
    private long b;
    private int c;

    public com.tencent.bugly.crashreport.biz.a(Context context) {
        a = context;
    }

    static long a(com.tencent.bugly.crashreport.biz.a a1) {
        return a1.b;
    }

    private static ContentValues a(UserInfoBean userinfobean) {
        Object obj = null;
        if (userinfobean != null) goto _L2; else goto _L1
_L1:
        userinfobean = obj;
_L4:
        return userinfobean;
_L2:
        ContentValues contentvalues;
        contentvalues = JVM INSTR new #36  <Class ContentValues>;
        contentvalues.ContentValues();
        if (userinfobean.a > 0L)
            contentvalues.put("_id", Long.valueOf(userinfobean.a));
        contentvalues.put("_tm", Long.valueOf(userinfobean.e));
        contentvalues.put("_ut", Long.valueOf(userinfobean.f));
        contentvalues.put("_tp", Integer.valueOf(userinfobean.b));
        contentvalues.put("_pc", userinfobean.c);
        Parcel parcel = Parcel.obtain();
        userinfobean.writeToParcel(parcel, 0);
        userinfobean = parcel.marshall();
        parcel.recycle();
        contentvalues.put("_dt", userinfobean);
        userinfobean = contentvalues;
        continue; /* Loop/switch isn't completed */
        Throwable throwable;
        throwable;
        userinfobean = obj;
        if (!ag.a(throwable)) {
            throwable.printStackTrace();
            userinfobean = obj;
        }
        if (true) goto _L4; else goto _L3
_L3:
    }

    private static UserInfoBean a(Cursor cursor) {
        if (cursor != null) goto _L2; else goto _L1
_L1:
        cursor = null;
_L4:
        return cursor;
_L2:
        byte abyte0[] = cursor.getBlob(cursor.getColumnIndex("_dt"));
        if (abyte0 == null) {
            cursor = null;
            continue; /* Loop/switch isn't completed */
        }
        long l;
        UserInfoBean userinfobean;
        l = cursor.getLong(cursor.getColumnIndex("_id"));
        userinfobean = (UserInfoBean)com.tencent.bugly.proguard.a.a(abyte0, UserInfoBean.CREATOR);
        cursor = userinfobean;
        if (userinfobean == null)
            continue; /* Loop/switch isn't completed */
        userinfobean.a = l;
        cursor = userinfobean;
        continue; /* Loop/switch isn't completed */
        cursor;
        if (!ag.a(cursor))
            cursor.printStackTrace();
        cursor = null;
        if (true) goto _L4; else goto _L3
_L3:
    }

    static void a(com.tencent.bugly.crashreport.biz.a a1, UserInfoBean userinfobean, boolean flag) {
        if (userinfobean == null) goto _L2; else goto _L1
_L1:
        if (flag || userinfobean.b == 1) goto _L4; else goto _L3
_L3:
        a1 = a1.a(com.tencent.bugly.crashreport.common.info.a.a(a1.a).d);
        if (a1 == null || a1.size() < 20) goto _L4; else goto _L5
_L5:
        ag.a("There are too many userinfo in local: %d", new Object[] {
            Integer.valueOf(a1.size())
        });
_L2:
        return;
_L4:
        a1 = a(userinfobean);
        long l = y.a().a("t_ui", a1, null, true);
        if (l >= 0L) {
            ag.c("insert %s success! %d", new Object[] {
                "t_ui", Long.valueOf(l)
            });
            userinfobean.a = l;
        }
        if (true) goto _L2; else goto _L6
_L6:
    }

    private static void a(List list) {
        if (list != null && list.size() != 0) goto _L2; else goto _L1
_L1:
        return;
_L2:
        StringBuilder stringbuilder = new StringBuilder();
        for (int i = 0; i < list.size() && i < 50; i++) {
            UserInfoBean userinfobean = (UserInfoBean)list.get(i);
            stringbuilder.append(" or _id").append(" = ").append(userinfobean.a);
        }

        String s = stringbuilder.toString();
        list = s;
        if (s.length() > 0)
            list = s.substring(4);
        stringbuilder.setLength(0);
        try {
            ag.c("deleted %s data %d", new Object[] {
                "t_ui", Integer.valueOf(y.a().a("t_ui", list, null, null, true))
            });
        }
        // Misplaced declaration of an exception variable
        catch (List list) {
            if (!ag.a(list))
                list.printStackTrace();
        }
        if (true) goto _L1; else goto _L3
_L3:
    }

    public final List a(String s) {
        boolean flag = false;
        if (s == null) goto _L2; else goto _L1
_L1:
        if (s.trim().length() <= 0) goto _L2; else goto _L3
_L3:
        if (!flag) goto _L5; else goto _L4
_L4:
        s = null;
_L8:
        s = y.a().a("t_ui", null, s, null, null, true);
        if (s != null) goto _L7; else goto _L6
_L6:
        if (s != null)
            s.close();
        s = null;
_L14:
        return s;
_L2:
        flag = true;
          goto _L3
_L5:
        StringBuilder stringbuilder = JVM INSTR new #181 <Class StringBuilder>;
        stringbuilder.StringBuilder("_pc = '");
        s = stringbuilder.append(s).append("'").toString();
          goto _L8
_L7:
        Object obj;
        Object obj1;
        obj1 = JVM INSTR new #181 <Class StringBuilder>;
        ((StringBuilder) (obj1)).StringBuilder();
        obj = JVM INSTR new #239 <Class ArrayList>;
        ((ArrayList) (obj)).ArrayList();
_L13:
        if (!s.moveToNext()) goto _L10; else goto _L9
_L9:
        UserInfoBean userinfobean = a(((Cursor) (s)));
        if (userinfobean == null) goto _L12; else goto _L11
_L11:
        ((List) (obj)).add(userinfobean);
          goto _L13
        obj;
_L16:
        if (!ag.a(((Throwable) (obj))))
            ((Throwable) (obj)).printStackTrace();
        if (s != null)
            s.close();
        s = null;
          goto _L14
_L12:
        long l = s.getLong(s.getColumnIndex("_id"));
        ((StringBuilder) (obj1)).append(" or _id").append(" = ").append(l);
          goto _L13
        Throwable throwable;
        throwable;
        ag.d("unknown id!", new Object[0]);
          goto _L13
        obj1;
        obj = s;
        s = ((String) (obj1));
_L15:
        if (obj != null)
            ((Cursor) (obj)).close();
        throw s;
_L10:
        obj1 = ((StringBuilder) (obj1)).toString();
        if (((String) (obj1)).length() > 0) {
            obj1 = ((String) (obj1)).substring(4);
            ag.d("[session] deleted %s error data %d", new Object[] {
                "t_ui", Integer.valueOf(y.a().a("t_ui", ((String) (obj1)), null, null, true))
            });
        }
        if (s != null)
            s.close();
        s = ((String) (obj));
          goto _L14
        s;
        obj = null;
          goto _L15
        obj;
        String s1 = s;
        s = ((String) (obj));
        obj = s1;
          goto _L15
        obj;
        s = null;
          goto _L16
    }

    public final void a() {
        b = com.tencent.bugly.proguard.a.c() + 0x5265c00L;
        af.a().a(new b(), (b - System.currentTimeMillis()) + 5000L);
    }

    public final void a(int i, boolean flag, long l) {
        int j = 1;
        StrategyBean strategybean = com.tencent.bugly.crashreport.common.strategy.a.a().c();
        if (strategybean != null && !strategybean.h && i != 1 && i != 3) {
            ag.e("UserInfo is disable", new Object[0]);
        } else {
            if (i == 1 || i == 3)
                c = c + 1;
            Object obj = a;
            com.tencent.bugly.crashreport.common.info.a a1;
            if (i != 1)
                j = 0;
            a1 = com.tencent.bugly.crashreport.common.info.a.a(((Context) (obj)));
            obj = new UserInfoBean();
            obj.b = i;
            obj.c = a1.d;
            obj.d = a1.f();
            obj.e = System.currentTimeMillis();
            obj.f = -1L;
            obj.n = a1.j;
            obj.o = j;
            obj.l = a1.o;
            obj.m = a1.p;
            obj.g = a1.q;
            obj.h = a1.r;
            obj.i = a1.s;
            obj.k = a1.t;
            obj.r = a1.y();
            obj.s = a1.C();
            obj.p = a1.D();
            obj.q = a1.E();
            af.a().a(new a(((UserInfoBean) (obj)), flag), 0L);
        }
    }

    public final void a(boolean flag) {
        this;
        JVM INSTR monitorenter ;
        if (flag)
            break MISSING_BLOCK_LABEL_32;
        af af1 = af.a();
        if (af1 == null)
            break MISSING_BLOCK_LABEL_32;
        Runnable runnable = JVM INSTR new #8   <Class a$2>;
        runnable.this. _cls2();
        af1.a(runnable);
_L1:
        this;
        JVM INSTR monitorexit ;
        return;
        b();
          goto _L1
        Exception exception;
        exception;
        throw exception;
    }

    public final void b() {
        Object obj;
        Object obj1;
        obj = com.tencent.bugly.crashreport.common.strategy.a.a().c();
        obj1 = ad.a();
        if (obj1 != null) goto _L2; else goto _L1
_L1:
        return;
_L2:
        int i;
        char c1;
        String s;
        Object obj2;
        if (((ad) (obj1)).a)
            obj = ((StrategyBean) (obj)).r;
        else
            obj = ((StrategyBean) (obj)).t;
        if (((ad) (obj1)).a)
            s = StrategyBean.b;
        else
            s = StrategyBean.a;
        if (((ad) (obj1)).a)
            c1 = '\u0348';
        else
            c1 = '\u0280';
        i = 1;
        obj1 = com.tencent.bugly.crashreport.common.info.a.a(a).d;
        obj2 = new ArrayList();
        obj1 = a(((String) (obj1)));
        if (obj1 != null) {
            int k = ((List) (obj1)).size() - 20;
            if (k > 0) {
                for (i = 0; i < ((List) (obj1)).size() - 1; i++) {
                    for (int j = i + 1; j < ((List) (obj1)).size(); j++)
                        if (((UserInfoBean)((List) (obj1)).get(i)).e > ((UserInfoBean)((List) (obj1)).get(j)).e) {
                            UserInfoBean userinfobean = (UserInfoBean)((List) (obj1)).get(i);
                            ((List) (obj1)).set(i, ((List) (obj1)).get(j));
                            ((List) (obj1)).set(j, userinfobean);
                        }

                }

                for (i = 0; i < k; i++)
                    ((List) (obj2)).add(((List) (obj1)).get(i));

            }
            Object obj3 = ((List) (obj1)).iterator();
            i = 0;
            do {
                if (!((Iterator) (obj3)).hasNext())
                    break;
                UserInfoBean userinfobean1 = (UserInfoBean)((Iterator) (obj3)).next();
                if (userinfobean1.f != -1L) {
                    ((Iterator) (obj3)).remove();
                    if (userinfobean1.e < com.tencent.bugly.proguard.a.c())
                        ((List) (obj2)).add(userinfobean1);
                }
                if (userinfobean1.e > System.currentTimeMillis() - 0x927c0L && (userinfobean1.b == 1 || userinfobean1.b == 4 || userinfobean1.b == 3))
                    i++;
            } while (true);
            boolean flag1;
            byte abyte0[];
            if (i > 15) {
                boolean flag = false;
                ag.d("[userinfo] userinfo too many times in 10 min: %d", new Object[] {
                    Integer.valueOf(i)
                });
                i = ((flag) ? 1 : 0);
            } else {
                i = 1;
            }
        } else {
            obj1 = new ArrayList();
        }
        if (((List) (obj2)).size() > 0)
            a(((List) (obj2)));
        if (i != 0 && ((List) (obj1)).size() != 0) {
            ag.c("[userinfo] do userinfo, size: %d", new Object[] {
                Integer.valueOf(((List) (obj1)).size())
            });
            if (c == 1)
                i = 1;
            else
                i = 2;
            obj2 = com.tencent.bugly.proguard.a.a(((List) (obj1)), i);
            if (obj2 == null) {
                ag.d("[biz] create uPkg fail!", new Object[0]);
            } else {
                abyte0 = com.tencent.bugly.proguard.a.a(((com.tencent.bugly.proguard.j) (obj2)));
                if (abyte0 == null) {
                    ag.d("[biz] send encode fail!", new Object[0]);
                } else {
                    abyte0 = com.tencent.bugly.proguard.a.a(a, c1, abyte0);
                    if (abyte0 == null) {
                        ag.d("request package is null.", new Object[0]);
                    } else {
                        obj1 = new ac(((List) (obj1))) {

                            private List a;
                            private com.tencent.bugly.crashreport.biz.a b;

                            public final void a(int l, ax ax, long l1, long l2, boolean flag2, 
                                    String s1) {
                                if (flag2) {
                                    ag.c("up success do final", new Object[0]);
                                    l1 = System.currentTimeMillis();
                                    for (s1 = a.iterator(); s1.hasNext(); com.tencent.bugly.crashreport.biz.a.a(b, ax, true)) {
                                        ax = (UserInfoBean)s1.next();
                                        ax.f = l1;
                                    }

                                }
                            }

             {
                b = com.tencent.bugly.crashreport.biz.a.this;
                a = list;
                super();
            }
                        }
;
                        obj3 = ad.a();
                        if (c == 1)
                            flag1 = true;
                        else
                            flag1 = false;
                        ((ad) (obj3)).a(1001, abyte0, ((String) (obj)), s, ((ac) (obj1)), flag1);
                    }
                }
            }
        }
        if (true) goto _L1; else goto _L3
_L3:
    }

    // Unreferenced inner class com/tencent/bugly/crashreport/biz/a$2

/* anonymous class */
    final class _cls2
        implements Runnable {

        private com.tencent.bugly.crashreport.biz.a a;

        public final void run() {
            a.b();
        }

             {
                a = com.tencent.bugly.crashreport.biz.a.this;
                super();
            }
    }

}
